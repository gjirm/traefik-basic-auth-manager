<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-wEmeIV1mKuiNpC+IOBjI7aAzPcEZeedi5yW5f2yOq55WWLwNGmvvx4Um1vskeMj0" crossorigin="anonymous">
    <title>Download uploaded file</title>
</head>
<body>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-p34f1UUtsS3wqzfto5wAAmdvj+osOnFyQFpp4Ua3gs/ZVWx6oOypYoCJhGGScy+8" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <div class="container mt-5" style="width: 576px;">
        <div class="mb-3">
            <h3>Manage your credentials {{.user}}</h3>
        </div>
        <div class="mb-3">
            <div class="list-group">
                <a href="#" class="list-group-item list-group-item-action list-group-item-primary" >Activate credentials</a>
                <a href="#" class="list-group-item list-group-item-action list-group-item-primary" onclick="generateCredentials()">Generate new credentials</a>
            </div>
        </div>
        <div class="mb-3">
            <div class="alert alert-info" role="alert" id="status" style="display:none;"></div>
        </div>
    </div>
</body>
<script>

    document.addEventListener('readystatechange', event => { 
        if (event.target.readyState === "complete") {
           chechUser();
        }
    });

    function chechUser() {
        document.getElementById("status").style.display = "block";
        var xmlhttp = new XMLHttpRequest();

        xmlhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                console.log('response', this.responseText);
                if (this.responseText == "User not exists") {
                    document.getElementById("status").className = "alert alert-warning"
                    document.getElementById("status").innerHTML = "You have no credentials. Please generate new";
                } else {
                    var myArr = JSON.parse(this.responseText);
                    displayCredentials(myArr);
                }

            }
        };
        xmlhttp.open("GET", "/getuser", true);
        xmlhttp.send();

        function displayCredentials(arr) {
            out = "Username: " + arr.username + "<br>Validity: " + arr.validity + "<br>";
            document.getElementById("status").innerHTML = out;
        }
    }

    function generateCredentials() {
        document.getElementById("status").style.display = "block";
        var xmlhttp = new XMLHttpRequest();

        xmlhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                console.log('response', this.responseText);
                var myArr = JSON.parse(this.responseText);
                displayCredentials(myArr);

            }
        };
        xmlhttp.open("GET", "/generate", true);
        xmlhttp.send();

        function displayCredentials(arr) {
            out = "Username: " + arr.username + "<br>Password: " + arr.password + "<br>";
            document.getElementById("status").className = "alert alert-success"
            document.getElementById("status").innerHTML = out;
        }
    }
</script>
</html>
